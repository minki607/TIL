# 클로저

"함수와 그 함수가 선언된 렉시컬 환경과의 조합" - MDN

외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명 주기가 종료한 외부 함수의 변수를 참조할 수 있음. 이런 중첩 함수를 클로저라 부름.

## 렉시컬 스코프

- 함수를 어디서 호출했는지가 아니라 어디에 정의했는지에 따라 상위 스코프를 결정 (정적 스코프)

- 함수 상위 스코프를 결정 = 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 저장할 참조값을 결정

- 이런 상위 스코프를 기억하기 위해 함수는 자신의 내부 슬롯 `[[Environment]]`에 자신이 정의된 환경을 저장

- 함수가 호출되었을 때 생성될 함수 렉시컬 환경의 OuterLexicalEnvironmentReference에 저장될 참조값

```javascript
 function outer() {
   const x = 10;
   const inner = function (){ console.log(x);}
   return inner;
  }

  const innerFunc = outer();
  innerFunc();
```

위 예제에서 outer 함수를 호출하면 outer 함수의 렉시컬 환경이 생성되고 함수 객체 `[[Environment]]` 슬롯에 전역 렉시컬 환경을 Outer Lexical Environment Reference로 등록

inner는 자신의 `[[Environment]]` 내부 슬롯에 현재 실행중인 실행 컨텍스트의 렉시컬 환경인 outer 함수의 렉시컬 환경을 상위 스코프로 등록.

outer 함수 실행이 종료되면 inner 함수가 반환되고 outer 함수 생명주기가 종료되며 실행 컨텍스트 스택에서 제거됨.

그래도 outer 함수의 렉시컬 환경은 inner 함수의 내부슬롯에 의해 참조되고 있기 때문에 outer의 렉시컬 환경은 남아있음. 

참조되는 값은 가비지 컬렉션의 대상이 되지않음.

## 클로저의 활용

- 클로저는 상태를 안전하게 변경하고 유지하기 위해 사용
- 상태를 안전하게 은닉하고 특정 함수에게만 성태 변경을 허용

# 수업때 내용 추가 --
실행컨텍스트 이해가 안되는부분이있어서 다시 보고 수정